<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>5.8. Using &#8220;ticky-ticky&#8221; profiling (for implementors)</title><link rel="stylesheet" href="fptools.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"><link rel="home" href="index.html" title="The Parallel Haskell Compilation System User's Guide, Version 7.4.2"><link rel="up" href="profiling.html" title="Chapter 5. Profiling"><link rel="prev" href="hpc.html" title="5.7. Observing Code Coverage"><link rel="next" href="sooner-faster-quicker.html" title="Chapter 6. Advice on: sooner, faster, smaller, thriftier"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">5.8. Using &#8220;ticky-ticky&#8221; profiling (for implementors)</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="hpc.html">Prev</a> </td><th width="60%" align="center">Chapter 5. Profiling</th><td width="20%" align="right"> <a accesskey="n" href="sooner-faster-quicker.html">Next</a></td></tr></table><hr></div><div class="sect1" title="5.8. Using &#8220;ticky-ticky&#8221; profiling (for implementors)"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ticky-ticky"></a>5.8. Using &#8220;ticky-ticky&#8221; profiling (for implementors)</h2></div></div></div><a class="indexterm" name="idp27889824"></a><p>(ToDo: document properly.)</p><p>It is possible to compile Haskell programs so that
    they will count lots and lots of interesting things, e.g., number
    of updates, number of data constructors entered, etc., etc.  We
    call this &#8220;ticky-ticky&#8221;
    profiling,<a class="indexterm" name="idp27703488"></a> <a class="indexterm" name="idp27891256"></a> because that's the sound a CPU
    makes when it is running up all those counters
    (<span class="emphasis"><em>slowly</em></span>).</p><p>Ticky-ticky profiling is mainly intended for implementors;
    it is quite separate from the main &#8220;cost-centre&#8221;
    profiling system, intended for all users everywhere.</p><p>
      You don't need to build GHC, the libraries, or the RTS a special
      way in order to use ticky-ticky profiling.  You can decide on a
      module-by-module basis which parts of a program have the
      counters compiled in, using the
      compile-time <code class="option">-ticky</code> option.  Those modules that
      were not compiled with <code class="option">-ticky</code> won't contribute
      to the ticky-ticky profiling results, and that will normally
      include all the pre-compiled packages that your program links
      with.
    </p><p>
      To get your compiled program to spit out the ticky-ticky
      numbers:

      </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
            Link the program with <code class="option">-debug</code>
            (<code class="option">-ticky</code> is a synonym
            for <code class="option">-debug</code> at link-time).  This links in
            the debug version of the RTS, which includes the code for
            aggregating and reporting the results of ticky-ticky
            profiling.
          </p></li><li class="listitem"><p>
            Run the program with the <code class="option">-r</code> RTS
            option<a class="indexterm" name="idp27895736"></a>.
            See <a class="xref" href="runtime-control.html" title="4.17. Running a compiled program">Section 4.17, &#8220;Running a compiled program&#8221;</a>.
          </p></li></ul></div><p>
    </p><p>
      Here is a sample ticky-ticky statistics file, generated by
      the invocation
      <span class="command"><strong>foo +RTS -rfoo.ticky</strong></span>.
      </p><pre class="screen">
 foo +RTS -rfoo.ticky

ALLOCATIONS: 3964631 (11330900 words total: 3999476 admin, 6098829 goods, 1232595 slop)
                                total words:        2     3     4     5    6+
  69647 (  1.8%) function values                 50.0  50.0   0.0   0.0   0.0
2382937 ( 60.1%) thunks                           0.0  83.9  16.1   0.0   0.0
1477218 ( 37.3%) data values                     66.8  33.2   0.0   0.0   0.0
      0 (  0.0%) big tuples
      2 (  0.0%) black holes                      0.0 100.0   0.0   0.0   0.0
      0 (  0.0%) prim things
  34825 (  0.9%) partial applications             0.0   0.0   0.0 100.0   0.0
      2 (  0.0%) thread state objects             0.0   0.0   0.0   0.0 100.0

Total storage-manager allocations: 3647137 (11882004 words)
        [551104 words lost to speculative heap-checks]

STACK USAGE:

ENTERS: 9400092  of which 2005772 (21.3%) direct to the entry code
                  [the rest indirected via Node's info ptr]
1860318 ( 19.8%) thunks
3733184 ( 39.7%) data values
3149544 ( 33.5%) function values
                  [of which 1999880 (63.5%) bypassed arg-satisfaction chk]
 348140 (  3.7%) partial applications
 308906 (  3.3%) normal indirections
      0 (  0.0%) permanent indirections

RETURNS: 5870443
2137257 ( 36.4%) from entering a new constructor
                  [the rest from entering an existing constructor]
2349219 ( 40.0%) vectored [the rest unvectored]

RET_NEW:         2137257:  32.5% 46.2% 21.3%  0.0%  0.0%  0.0%  0.0%  0.0%  0.0%
RET_OLD:         3733184:   2.8% 67.9% 29.3%  0.0%  0.0%  0.0%  0.0%  0.0%  0.0%
RET_UNBOXED_TUP:       2:   0.0%  0.0%100.0%  0.0%  0.0%  0.0%  0.0%  0.0%  0.0%

RET_VEC_RETURN : 2349219:   0.0%  0.0%100.0%  0.0%  0.0%  0.0%  0.0%  0.0%  0.0%

UPDATE FRAMES: 2241725 (0 omitted from thunks)
SEQ FRAMES:    1
CATCH FRAMES:  1
UPDATES: 2241725
      0 (  0.0%) data values
  34827 (  1.6%) partial applications
                  [2 in place, 34825 allocated new space]
2206898 ( 98.4%) updates to existing heap objects (46 by squeezing)
UPD_CON_IN_NEW:         0:       0      0      0      0      0      0      0      0      0
UPD_PAP_IN_NEW:     34825:       0      0      0  34825      0      0      0      0      0

NEW GEN UPDATES: 2274700 ( 99.9%)

OLD GEN UPDATES: 1852 (  0.1%)

Total bytes copied during GC: 190096

**************************************************
3647137 ALLOC_HEAP_ctr
11882004 ALLOC_HEAP_tot
  69647 ALLOC_FUN_ctr
  69647 ALLOC_FUN_adm
  69644 ALLOC_FUN_gds
  34819 ALLOC_FUN_slp
  34831 ALLOC_FUN_hst_0
  34816 ALLOC_FUN_hst_1
      0 ALLOC_FUN_hst_2
      0 ALLOC_FUN_hst_3
      0 ALLOC_FUN_hst_4
2382937 ALLOC_UP_THK_ctr
      0 ALLOC_SE_THK_ctr
 308906 ENT_IND_ctr
      0 E!NT_PERM_IND_ctr requires +RTS -Z
[... lots more info omitted ...]
      0 GC_SEL_ABANDONED_ctr
      0 GC_SEL_MINOR_ctr
      0 GC_SEL_MAJOR_ctr
      0 GC_FAILED_PROMOTION_ctr
  47524 GC_WORDS_COPIED_ctr
</pre><p>The formatting of the information above the row of asterisks
    is subject to change, but hopefully provides a useful
    human-readable summary.  Below the asterisks <span class="emphasis"><em>all
    counters</em></span> maintained by the ticky-ticky system are
    dumped, in a format intended to be machine-readable: zero or more
    spaces, an integer, a space, the counter name, and a newline.</p><p>In fact, not <span class="emphasis"><em>all</em></span> counters are
    necessarily dumped; compile- or run-time flags can render certain
    counters invalid.  In this case, either the counter will simply
    not appear, or it will appear with a modified counter name,
    possibly along with an explanation for the omission (notice
    <code class="literal">ENT_PERM_IND_ctr</code> appears
    with an inserted <code class="literal">!</code> above).  Software analysing
    this output should always check that it has the counters it
    expects.  Also, beware: some of the counters can have
    <span class="emphasis"><em>large</em></span> values!</p></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="hpc.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="profiling.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="sooner-faster-quicker.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">5.7. Observing Code Coverage </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 6. Advice on: sooner, faster, smaller, thriftier</td></tr></table></div></body></html>
