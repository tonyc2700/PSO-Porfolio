<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>4.19. Debugging the compiler</title><link rel="stylesheet" href="fptools.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"><link rel="home" href="index.html" title="The Parallel Haskell Compilation System User's Guide, Version 7.4.2"><link rel="up" href="using-ghc.html" title="Chapter 4. Using GHC"><link rel="prev" href="ext-core.html" title="4.18. Generating and compiling External Core Files"><link rel="next" href="flag-reference.html" title="4.20. Flag reference"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">4.19. Debugging the compiler</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ext-core.html">Prev</a> </td><th width="60%" align="center">Chapter 4. Using GHC</th><td width="20%" align="right"> <a accesskey="n" href="flag-reference.html">Next</a></td></tr></table><hr></div><div class="sect1" title="4.19. Debugging the compiler"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="options-debugging"></a>4.19. Debugging the compiler</h2></div></div></div><a class="indexterm" name="idp24073200"></a><p>HACKER TERRITORY. HACKER TERRITORY.  (You were warned.)</p><div class="sect2" title="4.19.1. Dumping out compiler intermediate structures"><div class="titlepage"><div><div><h3 class="title"><a name="dumping-output"></a>4.19.1. Dumping out compiler intermediate structures</h3></div></div></div><a class="indexterm" name="idp24037944"></a><a class="indexterm" name="idp24038368"></a><div class="variablelist"><dl><dt><span class="term">
          <code class="option">-ddump-</code><em class="replaceable"><code>pass</code></em>
          <a class="indexterm" name="idp24073648"></a>
        </span></dt><dd><p>Make a debugging dump after pass
        <code class="literal">&lt;pass&gt;</code> (may be common enough to need
        a short form&#8230;).  You can get all of these at once
        (<span class="emphasis"><em>lots</em></span> of output) by using
        <code class="option">-v5</code>, or most of them with
        <code class="option">-v4</code>.  You can prevent them from clogging up
        your standard output by passing <code class="option">-ddump-to-file</code>.
        Some of the most useful ones are:</p><div class="variablelist"><dl><dt><span class="term">
	        <code class="option">-ddump-parsed</code>:
                <a class="indexterm" name="idp24076744"></a>
	      </span></dt><dd><p>parser output</p></dd><dt><span class="term">
	        <code class="option">-ddump-rn</code>:
                <a class="indexterm" name="idp24098504"></a>
	      </span></dt><dd><p>renamer output</p></dd><dt><span class="term">
	        <code class="option">-ddump-tc</code>:
                <a class="indexterm" name="idp24100000"></a>
	      </span></dt><dd><p>typechecker output</p></dd><dt><span class="term">
	        <code class="option">-ddump-splices</code>:
                <a class="indexterm" name="idp24101504"></a>
	      </span></dt><dd><p>Dump Template Haskell expressions that we splice in,
                and what Haskell code the expression evaluates to.</p></dd><dt><span class="term">
	        <code class="option">-ddump-types</code>:
                <a class="indexterm" name="idp24103120"></a>
	      </span></dt><dd><p>Dump a type signature for each value defined at
              the top level of the module.  The list is sorted
              alphabetically.  Using <code class="option">-dppr-debug</code>
              dumps a type signature for all the imported and
              system-defined things as well; useful for debugging the
              compiler.</p></dd><dt><span class="term">
	        <code class="option">-ddump-deriv</code>:
                <a class="indexterm" name="idp24105144"></a>
	      </span></dt><dd><p>derived instances</p></dd><dt><span class="term">
	        <code class="option">-ddump-ds</code>:
                <a class="indexterm" name="idp24106648"></a>
	      </span></dt><dd><p>desugarer output</p></dd><dt><span class="term">
	        <code class="option">-ddump-spec</code>:
                <a class="indexterm" name="idp24108144"></a>
	      </span></dt><dd><p>output of specialisation pass</p></dd><dt><span class="term">
	        <code class="option">-ddump-rules</code>:
                <a class="indexterm" name="idp24109664"></a>
	      </span></dt><dd><p>dumps all rewrite rules specified in this module;
                      see <a class="xref" href="rewrite-rules.html#controlling-rules" title="7.17.6. Controlling what's going on in rewrite rules">Section 7.17.6, &#8220;Controlling what's going on in rewrite rules&#8221;</a>.
                </p></dd><dt><span class="term">
	        <code class="option">-ddump-rule-firings</code>:
                <a class="indexterm" name="idp24111656"></a>
	      </span></dt><dd><p>dumps the names of all rules that fired in this module</p></dd><dt><span class="term">
	        <code class="option">-ddump-rule-rewrites</code>:
                <a class="indexterm" name="idp24113216"></a>
	      </span></dt><dd><p>dumps detailed information about all rules that fired in
		      this module
		</p></dd><dt><span class="term">
	        <code class="option">-ddump-vect</code>:
                <a class="indexterm" name="idp24114792"></a>
	      </span></dt><dd><p>dumps the output of the vectoriser.
                </p></dd><dt><span class="term">
	        <code class="option">-ddump-simpl</code>:
                <a class="indexterm" name="idp24116336"></a>
	      </span></dt><dd><p>simplifier output (Core-to-Core passes)</p></dd><dt><span class="term">
	        <code class="option">-ddump-inlinings</code>:
                <a class="indexterm" name="idp24117824"></a>
	      </span></dt><dd><p>inlining info from the simplifier</p></dd><dt><span class="term">
	        <code class="option">-ddump-cpranal</code>:
                <a class="indexterm" name="idp24119352"></a>
	      </span></dt><dd><p>CPR analyser output</p></dd><dt><span class="term">
	        <code class="option">-ddump-stranal</code>:
                <a class="indexterm" name="idp24120864"></a>
	      </span></dt><dd><p>strictness analyser output</p></dd><dt><span class="term">
	        <code class="option">-ddump-cse</code>:
                <a class="indexterm" name="idp24122376"></a>
	      </span></dt><dd><p>CSE pass output</p></dd><dt><span class="term">
	        <code class="option">-ddump-worker-wrapper</code>:
                <a class="indexterm" name="idp24123888"></a>
	      </span></dt><dd><p>worker/wrapper split output</p></dd><dt><span class="term">
	        <code class="option">-ddump-occur-anal</code>:
                <a class="indexterm" name="idp24125336"></a>
	      </span></dt><dd><p>`occurrence analysis' output</p></dd><dt><span class="term">
	        <code class="option">-ddump-prep</code>:
                <a class="indexterm" name="idp24126840"></a>
	      </span></dt><dd><p>output of core preparation pass</p></dd><dt><span class="term">
	        <code class="option">-ddump-stg</code>:
                <a class="indexterm" name="idp24128352"></a>
	      </span></dt><dd><p>output of STG-to-STG passes</p></dd><dt><span class="term">
	        <code class="option">-ddump-flatC</code>:
                <a class="indexterm" name="idp24129864"></a>
	      </span></dt><dd><p><span class="emphasis"><em>flattened</em></span> Abstract C</p></dd><dt><span class="term">
	        <code class="option">-ddump-cmm</code>:
                <a class="indexterm" name="idp24131528"></a>
	      </span></dt><dd><p>Print the C-- code out.</p></dd><dt><span class="term">
	        <code class="option">-ddump-opt-cmm</code>:
                <a class="indexterm" name="idp24133024"></a>
	      </span></dt><dd><p>Dump the results of C-- to C-- optimising passes.</p></dd><dt><span class="term">
	        <code class="option">-ddump-asm</code>:
                <a class="indexterm" name="idp24134560"></a>
	      </span></dt><dd><p>assembly language from the
              <a class="link" href="code-generators.html#native-code-gen" title="4.11.1. Native code Generator (-fasm)">native code generator</a></p></dd><dt><span class="term">
	        <code class="option">-ddump-llvm</code>:
                <a class="indexterm" name="idp24136448"></a>
	      </span></dt><dd><p>LLVM code from the <a class="link" href="code-generators.html#llvm-code-gen" title="4.11.2. LLVM Code Generator (-fllvm)">LLVM code
	          generator</a></p></dd><dt><span class="term">
	        <code class="option">-ddump-bcos</code>:
                <a class="indexterm" name="idp24138320"></a>
	      </span></dt><dd><p>byte code compiler output</p></dd><dt><span class="term">
	        <code class="option">-ddump-foreign</code>:
                <a class="indexterm" name="idp24139832"></a>
	      </span></dt><dd><p>dump foreign export stubs</p></dd></dl></div></dd><dt><span class="term">
          <code class="option">-ddump-simpl-phases</code>:
          <a class="indexterm" name="idp24141544"></a>
        </span></dt><dd><p>Show the output of each run of the simplifier.  Used when even
        <code class="option">-dverbose-core2core</code> doesn't cut it.</p></dd><dt><span class="term">
          <code class="option">-ddump-simpl-iterations</code>:
          <a class="indexterm" name="idp24143360"></a>
        </span></dt><dd><p>Show the output of each <span class="emphasis"><em>iteration</em></span>
        of the simplifier (each run of the simplifier has a maximum
        number of iterations, normally 4).  This outputs even more information
        than <code class="option">-ddump-simpl-phases</code>.</p></dd><dt><span class="term">
          <code class="option">-ddump-simpl-stats</code>
          <a class="indexterm" name="idp24145456"></a>
        </span></dt><dd><p>Dump statistics about how many of each kind of
        transformation too place.  If you add
        <code class="option">-dppr-debug</code> you get more detailed
        information.</p></dd><dt><span class="term">
          <code class="option">-ddump-if-trace</code>
          <a class="indexterm" name="idp24147296"></a>
        </span></dt><dd><p>Make the interface loader be *real* chatty about what it is
	up to.</p></dd><dt><span class="term">
          <code class="option">-ddump-tc-trace</code>
          <a class="indexterm" name="idp24148832"></a>
        </span></dt><dd><p>Make the type checker be *real* chatty about what it is
  up to.</p></dd><dt><span class="term">
          <code class="option">-ddump-vt-trace</code>
          <a class="indexterm" name="idp24150368"></a>
        </span></dt><dd><p>Make the vectoriser be *real* chatty about what it is
  up to.</p></dd><dt><span class="term">
          <code class="option">-ddump-rn-trace</code>
          <a class="indexterm" name="idp24151904"></a>
        </span></dt><dd><p>Make the renamer be *real* chatty about what it is
	up to.</p></dd><dt><span class="term">
          <code class="option">-ddump-rn-stats</code>
          <a class="indexterm" name="idp24153432"></a>
        </span></dt><dd><p>Print out summary of what kind of information the renamer
        had to bring in.</p></dd><dt><span class="term">
          <code class="option">-dverbose-core2core</code>
          <a class="indexterm" name="idp24154984"></a>
        , </span><span class="term">
          <code class="option">-dverbose-stg2stg</code>
          <a class="indexterm" name="idp24155872"></a>
        </span></dt><dd><p>Show the output of the intermediate Core-to-Core and
        STG-to-STG passes, respectively.  (<span class="emphasis"><em>Lots</em></span>
        of output!) So: when we're really desperate:</p><pre class="screen">
% ghc -noC -O -ddump-simpl -dverbose-core2core -dcore-lint Foo.hs
</pre></dd><dt><span class="term">
          <code class="option">-dshow-passes</code>
          <a class="indexterm" name="idp24158120"></a>
        </span></dt><dd><p>Print out each pass name as it happens.</p></dd><dt><span class="term">
          <code class="option">-ddump-core-stats</code>
          <a class="indexterm" name="idp24159632"></a>
        </span></dt><dd><p>Print a one-line summary of the size of the Core program
                     at the end of the optimisation pipeline.</p></dd><dt><span class="term">
          <code class="option">-dfaststring-stats</code>
          <a class="indexterm" name="idp24161224"></a>
        </span></dt><dd><p>Show statistics for the usage of fast strings by the
          compiler.</p></dd><dt><span class="term">
          <code class="option">-dppr-debug</code>
          <a class="indexterm" name="idp24162760"></a>
        </span></dt><dd><p>Debugging output is in one of several
          &#8220;styles.&#8221; Take the printing of types, for
          example.  In the &#8220;user&#8221; style (the default), the
          compiler's internal ideas about types are presented in
          Haskell source-level syntax, insofar as possible.  In the
          &#8220;debug&#8221; style (which is the default for
          debugging output), the types are printed in with explicit
          foralls, and variables have their unique-id attached (so you
          can check for things that look the same but aren't).  This
          flag makes debugging output appear in the more verbose debug
          style.</p></dd></dl></div></div><div class="sect2" title="4.19.2. Formatting dumps"><div class="titlepage"><div><div><h3 class="title"><a name="formatting%20dumps"></a>4.19.2. Formatting dumps</h3></div></div></div><a class="indexterm" name="idp24165080"></a><div class="variablelist"><dl><dt><span class="term">
          <code class="option">-dppr-user-length</code>
          <a class="indexterm" name="idp24166080"></a>
        </span></dt><dd><p>In error messages, expressions are printed to a
	  certain &#8220;depth&#8221;, with subexpressions beyond the
	  depth replaced by ellipses.  This flag sets the
	  depth.  Its default value is 5.</p></dd><dt><span class="term">
          <code class="option">-dppr-colsNNN</code>
          <a class="indexterm" name="idp24167760"></a>
        </span></dt><dd><p>Set the width of debugging output. Use this if your code is wrapping too much.
		For example: <code class="option">-dppr-cols200</code>.</p></dd><dt><span class="term">
          <code class="option">-dppr-case-as-let</code>
          <a class="indexterm" name="idp24169528"></a>
        </span></dt><dd><p>Print single alternative case expressions as though they were strict
		let expressions. This is helpful when your code does a lot of unboxing.</p></dd><dt><span class="term">
          <code class="option">-dno-debug-output</code>
          <a class="indexterm" name="idp24171144"></a>
        </span></dt><dd><p>Suppress any unsolicited debugging output.  When GHC
            has been built with the <code class="literal">DEBUG</code> option it
            occasionally emits debug output of interest to developers.
            The extra output can confuse the testing framework and
            cause bogus test failures, so this flag is provided to
            turn it off.</p></dd></dl></div></div><div class="sect2" title="4.19.3. Suppressing unwanted information"><div class="titlepage"><div><div><h3 class="title"><a name="supression"></a>4.19.3. Suppressing unwanted information</h3></div></div></div><a class="indexterm" name="idp24173568"></a>

    Core dumps contain a large amount of information. Depending on what you are doing, not all of it will be useful.
    Use these flags to suppress the parts that you are not interested in.

    <div class="variablelist"><dl><dt><span class="term">
          <code class="option">-dsuppress-all</code>
          <a class="indexterm" name="idp24174768"></a>
        </span></dt><dd><p>Suppress everything that can be suppressed, except for unique ids as this often
		makes the printout ambiguous. If you just want to see the overall structure of
		the code, then start here.</p></dd><dt><span class="term">
          <code class="option">-dsuppress-uniques</code>
          <a class="indexterm" name="idp24176432"></a>
        </span></dt><dd><p>Suppress the printing of uniques. This may make
	  the printout ambiguous (e.g. unclear where an occurrence of 'x' is bound), but
	  it makes the output of two compiler runs have many fewer gratuitous differences,
	    so you can realistically apply <span class="command"><strong>diff</strong></span>.  Once <span class="command"><strong>diff</strong></span>
	  has shown you where to look, you can try again without <code class="option">-dsuppress-uniques</code></p></dd><dt><span class="term">
          <code class="option">-dsuppress-idinfo</code>
          <a class="indexterm" name="idp24179072"></a>
        </span></dt><dd><p>Suppress extended information about identifiers where they are bound. This includes
		strictness information and inliner templates. Using this flag can cut the size
		of the core dump in half, due to the lack of inliner templates</p></dd><dt><span class="term">
          <code class="option">-dsuppress-module-prefixes</code>
          <a class="indexterm" name="idp24180784"></a>
        </span></dt><dd><p>Suppress the printing of module qualification prefixes.
	        This is the <code class="constant">Data.List</code> in <code class="constant">Data.List.length</code>.</p></dd><dt><span class="term">
          <code class="option">-dsuppress-type-signatures</code>
          <a class="indexterm" name="idp24182792"></a>
        </span></dt><dd><p>Suppress the printing of type signatures.</p></dd><dt><span class="term">
          <code class="option">-dsuppress-type-applications</code>
          <a class="indexterm" name="idp24184328"></a>
        </span></dt><dd><p>Suppress the printing of type applications.</p></dd><dt><span class="term">
          <code class="option">-dsuppress-coercions</code>
          <a class="indexterm" name="idp24185864"></a>
        </span></dt><dd><p>Suppress the printing of type coercions.</p></dd></dl></div></div><div class="sect2" title="4.19.4. Checking for consistency"><div class="titlepage"><div><div><h3 class="title"><a name="checking-consistency"></a>4.19.4. Checking for consistency</h3></div></div></div><a class="indexterm" name="idp24187640"></a><a class="indexterm" name="idp24188056"></a><div class="variablelist"><dl><dt><span class="term">
          <code class="option">-dcore-lint</code>
          <a class="indexterm" name="idp24189056"></a>
        </span></dt><dd><p>Turn on heavyweight intra-pass sanity-checking within
          GHC, at Core level.  (It checks GHC's sanity, not yours.)</p></dd><dt><span class="term">
          <code class="option">-dstg-lint</code>:
          <a class="indexterm" name="idp24190656"></a>
        </span></dt><dd><p>Ditto for STG level. (NOTE: currently doesn't work).</p></dd><dt><span class="term">
          <code class="option">-dcmm-lint</code>:
          <a class="indexterm" name="idp24192192"></a>
        </span></dt><dd><p>Ditto for C-- level.</p></dd></dl></div></div><div class="sect2" title="4.19.5. How to read Core syntax (from some -ddump flags)"><div class="titlepage"><div><div><h3 class="title"><a name="idp24193336"></a>4.19.5. How to read Core syntax (from some <code class="option">-ddump</code>
    flags)</h3></div></div></div><a class="indexterm" name="idp24193920"></a><a class="indexterm" name="idp24194336"></a><p>Let's do this by commenting an example.  It's from doing
    <code class="option">-ddump-ds</code> on this code:

</p><pre class="programlisting">
skip2 m = m : skip2 (m+2)
</pre><p>

    Before we jump in, a word about names of things.  Within GHC,
    variables, type constructors, etc., are identified by their
    &#8220;Uniques.&#8221; These are of the form `letter' plus
    `number' (both loosely interpreted).  The `letter' gives some idea
    of where the Unique came from; e.g., <code class="literal">_</code>
    means &#8220;built-in type variable&#8221;; <code class="literal">t</code>
    means &#8220;from the typechecker&#8221;; <code class="literal">s</code>
    means &#8220;from the simplifier&#8221;; and so on.  The `number'
    is printed fairly compactly in a `base-62' format, which everyone
    hates except me (WDP).</p><p>Remember, everything has a &#8220;Unique&#8221; and it is
    usually printed out when debugging, in some form or another.  So
    here we go&#8230;</p><pre class="programlisting">
Desugared:
Main.skip2{-r1L6-} :: _forall_ a$_4 =&gt;{{Num a$_4}} -&gt; a$_4 -&gt; [a$_4]

--# `r1L6' is the Unique for Main.skip2;
--# `_4' is the Unique for the type-variable (template) `a'
--# `{{Num a$_4}}' is a dictionary argument

_NI_

--# `_NI_' means "no (pragmatic) information" yet; it will later
--# evolve into the GHC_PRAGMA info that goes into interface files.

Main.skip2{-r1L6-} =
    /\ _4 -&gt; \ d.Num.t4Gt -&gt;
        let {
          {- CoRec -}
          +.t4Hg :: _4 -&gt; _4 -&gt; _4
          _NI_
          +.t4Hg = (+{-r3JH-} _4) d.Num.t4Gt

          fromInt.t4GS :: Int{-2i-} -&gt; _4
          _NI_
          fromInt.t4GS = (fromInt{-r3JX-} _4) d.Num.t4Gt

--# The `+' class method (Unique: r3JH) selects the addition code
--# from a `Num' dictionary (now an explicit lambda'd argument).
--# Because Core is 2nd-order lambda-calculus, type applications
--# and lambdas (/\) are explicit.  So `+' is first applied to a
--# type (`_4'), then to a dictionary, yielding the actual addition
--# function that we will use subsequently...

--# We play the exact same game with the (non-standard) class method
--# `fromInt'.  Unsurprisingly, the type `Int' is wired into the
--# compiler.

          lit.t4Hb :: _4
          _NI_
          lit.t4Hb =
              let {
                ds.d4Qz :: Int{-2i-}
                _NI_
                ds.d4Qz = I#! 2#
              } in  fromInt.t4GS ds.d4Qz

--# `I# 2#' is just the literal Int `2'; it reflects the fact that
--# GHC defines `data Int = I# Int#', where Int# is the primitive
--# unboxed type.  (see relevant info about unboxed types elsewhere...)

--# The `!' after `I#' indicates that this is a *saturated*
--# application of the `I#' data constructor (i.e., not partially
--# applied).

          skip2.t3Ja :: _4 -&gt; [_4]
          _NI_
          skip2.t3Ja =
              \ m.r1H4 -&gt;
                  let { ds.d4QQ :: [_4]
                        _NI_
                        ds.d4QQ =
                    let {
                      ds.d4QY :: _4
                      _NI_
                      ds.d4QY = +.t4Hg m.r1H4 lit.t4Hb
                    } in  skip2.t3Ja ds.d4QY
                  } in
                  :! _4 m.r1H4 ds.d4QQ

          {- end CoRec -}
        } in  skip2.t3Ja
</pre><p>(&#8220;It's just a simple functional language&#8221; is an
    unregisterised trademark of Peyton Jones Enterprises, plc.)</p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ext-core.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="using-ghc.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="flag-reference.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">4.18. Generating and compiling External Core Files </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 4.20. Flag reference</td></tr></table></div></body></html>
