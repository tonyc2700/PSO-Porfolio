<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>4.5. Modes of operation</title><link rel="stylesheet" href="fptools.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"><link rel="home" href="index.html" title="The Parallel Haskell Compilation System User's Guide, Version 7.4.2"><link rel="up" href="using-ghc.html" title="Chapter 4. Using GHC"><link rel="prev" href="file-suffixes.html" title="4.4. Meaningful file suffixes"><link rel="next" href="options-help.html" title="4.6. Help and verbosity options"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">4.5. Modes of operation</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="file-suffixes.html">Prev</a> </td><th width="60%" align="center">Chapter 4. Using GHC</th><td width="20%" align="right"> <a accesskey="n" href="options-help.html">Next</a></td></tr></table><hr></div><div class="sect1" title="4.5. Modes of operation"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="modes"></a>4.5. Modes of operation</h2></div></div></div><p>
      GHC's behaviour is firstly controlled by a mode flag.  Only one
      of these flags may be given, but it does not necessarily need to
      be the first option on the command-line.
    </p><p>
      If no mode flag is present, then GHC will enter make mode
      (<a class="xref" href="modes.html#make-mode" title="4.5.1. Using ghc &#8211;&#8211;make">Section 4.5.1, &#8220;Using <span class="command"><strong>ghc</strong></span> <code class="option">&#8211;&#8211;make</code>&#8221;</a>) if there are any Haskell source
      files given on the command line, or else it will link the
      objects named on the command line to produce an executable.
    </p><p>The available mode flags are:</p><div class="variablelist"><dl><dt><span class="term">
	  <div class="cmdsynopsis"><p><code class="command">ghc --interactive</code> </p></div>
          <a class="indexterm" name="idp21634064"></a>
          <a class="indexterm" name="idp21634480"></a>
	</span></dt><dd><p>Interactive mode, which is also available as
	  <span class="command"><strong>ghci</strong></span>.  Interactive mode is described in
	  more detail in <a class="xref" href="ghci.html" title="Chapter 2. Using GHCi">Chapter 2, <i>Using GHCi</i></a>.</p></dd><dt><span class="term">
	  <div class="cmdsynopsis"><p><code class="command">ghc &#8211;&#8211;make</code> </p></div>
          <a class="indexterm" name="idp21637088"></a>
          <a class="indexterm" name="idp21637464"></a>
	</span></dt><dd><p>In this mode, GHC will build a multi-module Haskell
	  program automatically, figuring out dependencies for itself.
	  If you have a straightforward Haskell program, this is
	  likely to be much easier, and faster, than using
	  <span class="command"><strong>make</strong></span>.  Make mode is described in <a class="xref" href="modes.html#make-mode" title="4.5.1. Using ghc &#8211;&#8211;make">Section 4.5.1, &#8220;Using <span class="command"><strong>ghc</strong></span> <code class="option">&#8211;&#8211;make</code>&#8221;</a>.</p><p>
            This mode is the default if there are any Haskell
            source files mentioned on the command line, and in this case
            the <code class="option">&#8211;&#8211;make</code> option can be omitted.
          </p></dd><dt><span class="term">
	  <div class="cmdsynopsis"><p><code class="command">ghc -e</code>   <em class="replaceable"><code>expr</code></em> </p></div>
          <a class="indexterm" name="idp21641400"></a>
	</span></dt><dd><p>Expression-evaluation mode.  This is very similar to
	  interactive mode, except that there is a single expression
	  to evaluate (<em class="replaceable"><code>expr</code></em>) which is given
	  on the command line.  See <a class="xref" href="modes.html#eval-mode" title="4.5.2. Expression evaluation mode">Section 4.5.2, &#8220;Expression evaluation mode&#8221;</a> for
	  more details.</p></dd><dt><span class="term">
          <div class="cmdsynopsis"><p><code class="command">ghc -E</code> <br><code class="command">ghc -c</code> <br><code class="command">ghc -S</code> <br><code class="command">ghc -c</code> </p></div>
	  <a class="indexterm" name="idp21645120"></a>
	  <a class="indexterm" name="idp21645576"></a>
	  <a class="indexterm" name="idp21646056"></a>
	  <a class="indexterm" name="idp21646512"></a>
        </span></dt><dd><p>This is the traditional batch-compiler mode, in which
	  GHC can compile source files one at a time, or link objects
	  together into an executable.  This mode also applies if
	  there is no other mode flag specified on the command line,
	  in which case it means that the specified files should be
	  compiled and then linked to form a program. See <a class="xref" href="modes.html#options-order" title="4.5.3. Batch compiler mode">Section 4.5.3, &#8220;Batch compiler mode&#8221;</a>.</p></dd><dt><span class="term">
          <div class="cmdsynopsis"><p><code class="command">ghc -M</code> </p></div>
          <a class="indexterm" name="idp21649184"></a>
        </span></dt><dd><p>Dependency-generation mode.  In this mode, GHC can be
	  used to generate dependency information suitable for use in
	  a <code class="literal">Makefile</code>.  See <a class="xref" href="separate-compilation.html#makefile-dependencies" title="4.7.11. Dependency generation">Section 4.7.11, &#8220;Dependency generation&#8221;</a>.</p></dd><dt><span class="term">
          <div class="cmdsynopsis"><p><code class="command">ghc --mk-dll</code> </p></div>
	  <a class="indexterm" name="idp21651992"></a>
        </span></dt><dd><p>DLL-creation mode (Windows only).  See <a class="xref" href="win32-dlls.html#win32-dlls-create" title="12.6.1. Creating a DLL">Section 12.6.1, &#8220;Creating a DLL&#8221;</a>.</p></dd><dt><span class="term">
	  <div class="cmdsynopsis"><p><code class="command">ghc --help</code> <br><code class="command">ghc -?</code> </p></div>
          <a class="indexterm" name="idp21654656"></a>
        </span></dt><dd><p>Cause GHC to spew a long usage message to standard
          output and then exit.</p></dd><dt><span class="term">
          <div class="cmdsynopsis"><p><code class="command">ghc --show-iface <em class="replaceable"><code>file</code></em></code> </p></div>
          <a class="indexterm" name="idp21656784"></a>
        </span></dt><dd><p>Read the interface in
	      <em class="replaceable"><code>file</code></em> and dump it as text to
	      <code class="literal">stdout</code>. For example <code class="literal">ghc --show-iface M.hi</code>.</p></dd><dt><span class="term">
          <div class="cmdsynopsis"><p><code class="command">ghc --supported-extensions</code> <br><code class="command">ghc --supported-languages</code> </p></div>
          <a class="indexterm" name="idp21660064"></a>
        </span></dt><dd><p>Print the supported language extensions.</p></dd><dt><span class="term">
          <div class="cmdsynopsis"><p><code class="command">ghc --info</code> </p></div>
          <a class="indexterm" name="idp21662264"></a>
        </span></dt><dd><p>Print information about the compiler.</p></dd><dt><span class="term">
          <div class="cmdsynopsis"><p><code class="command">ghc --version</code> <br><code class="command">ghc -V</code> </p></div>
          <a class="indexterm" name="idp21664576"></a>
          <a class="indexterm" name="idp21665032"></a>
        </span></dt><dd><p>Print a one-line string including GHC's version number.</p></dd><dt><span class="term">
          <div class="cmdsynopsis"><p><code class="command">ghc --numeric-version</code> </p></div>
          <a class="indexterm" name="idp21667032"></a>
        </span></dt><dd><p>Print GHC's numeric version number only.</p></dd><dt><span class="term">
	  <div class="cmdsynopsis"><p><code class="command">ghc --print-libdir</code> </p></div>
          <a class="indexterm" name="idp21669016"></a>
        </span></dt><dd><p>Print the path to GHC's library directory.  This is
	  the top of the directory tree containing GHC's libraries,
	  interfaces, and include files (usually something like
	  <code class="literal">/usr/local/lib/ghc-5.04</code> on Unix).  This
	  is the value of
	  <code class="literal">$libdir</code><a class="indexterm" name="idp21670688"></a>
      in the package configuration file
      (see <a class="xref" href="packages.html" title="4.9.  Packages">Section 4.9, &#8220;
Packages
 &#8221;</a>).</p></dd></dl></div><div class="sect2" title="4.5.1. Using ghc &#8211;&#8211;make"><div class="titlepage"><div><div><h3 class="title"><a name="make-mode"></a>4.5.1. Using <span class="command"><strong>ghc</strong></span> <code class="option">&#8211;&#8211;make</code></h3></div></div></div><a class="indexterm" name="idp21672976"></a><a class="indexterm" name="idp21673448"></a><p>In this mode, GHC will build a multi-module Haskell program by following
      dependencies from one or more root modules (usually just
      <code class="literal">Main</code>).  For example, if your
      <code class="literal">Main</code> module is in a file called
      <code class="filename">Main.hs</code>, you could compile and link the
      program like this:</p><pre class="screen">
ghc &#8211;&#8211;make Main.hs
</pre><p>
        In fact, GHC enters make mode automatically if there are any
        Haskell source files on the command line and no other mode is
        specified, so in this case we could just type
      </p><pre class="screen">
ghc Main.hs
</pre><p>Any number of source file names or module names may be
      specified; GHC will figure out all the modules in the program by
      following the imports from these initial modules.  It will then
      attempt to compile each module which is out of date, and
      finally, if there is a <code class="literal">Main</code> module, the
      program will also be linked into an executable.</p><p>The main advantages to using <code class="literal">ghc
      &#8211;&#8211;make</code> over traditional
      <code class="literal">Makefile</code>s are:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>GHC doesn't have to be restarted for each compilation,
	  which means it can cache information between compilations.
	  Compiling a multi-module program with <code class="literal">ghc
	  &#8211;&#8211;make</code> can be up to twice as fast as
	  running <code class="literal">ghc</code> individually on each source
	  file.</p></li><li class="listitem"><p>You don't have to write a <code class="literal">Makefile</code>.</p><a class="indexterm" name="idp21680544"></a></li><li class="listitem"><p>GHC re-calculates the dependencies each time it is
	  invoked, so the dependencies never get out of sync with the
	  source.</p></li></ul></div><p>Any of the command-line options described in the rest of
      this chapter can be used with
      <code class="option">&#8211;&#8211;make</code>, but note that any options
      you give on the command line will apply to all the source files
      compiled, so if you want any options to apply to a single source
      file only, you'll need to use an <code class="literal">OPTIONS_GHC</code>
      pragma (see <a class="xref" href="ch04s02.html#source-file-options" title="4.2.2. Command line options in source files">Section 4.2.2, &#8220;Command line options in source files&#8221;</a>).</p><p>If the program needs to be linked with additional objects
      (say, some auxiliary C code), then the object files can be
      given on the command line and GHC will include them when linking
      the executable.</p><p>Note that GHC can only follow dependencies if it has the
      source file available, so if your program includes a module for
      which there is no source file, even if you have an object and an
      interface file for the module, then GHC will complain.  The
      exception to this rule is for package modules, which may or may
      not have source files.</p><p>The source files for the program don't all need to be in
      the same directory; the <code class="option">-i</code> option can be used
      to add directories to the search path (see <a class="xref" href="separate-compilation.html#search-path" title="4.7.3. The search path">Section 4.7.3, &#8220;The search path&#8221;</a>).</p></div><div class="sect2" title="4.5.2. Expression evaluation mode"><div class="titlepage"><div><div><h3 class="title"><a name="eval-mode"></a>4.5.2. Expression evaluation mode</h3></div></div></div><p>This mode is very similar to interactive mode, except that
      there is a single expression to evaluate which is specified on
      the command line as an argument to the <code class="option">-e</code>
      option:</p><pre class="screen">
ghc -e <em class="replaceable"><code>expr</code></em>
</pre><p>Haskell source files may be named on the command line, and
      they will be loaded exactly as in interactive mode.  The
      expression is evaluated in the context of the loaded
      modules.</p><p>For example, to load and run a Haskell program containing
      a module <code class="literal">Main</code>, we might say</p><pre class="screen">
ghc -e Main.main Main.hs
</pre><p>or we can just use this mode to evaluate expressions in
      the context of the <code class="literal">Prelude</code>:</p><pre class="screen">
$ ghc -e "interact (unlines.map reverse.lines)"
hello
olleh
</pre></div><div class="sect2" title="4.5.3. Batch compiler mode"><div class="titlepage"><div><div><h3 class="title"><a name="options-order"></a>4.5.3. Batch compiler mode</h3></div></div></div><p>In <span class="emphasis"><em>batch mode</em></span>, GHC will compile one or more source files
      given on the command line.</p><p>The first phase to run is determined by each input-file
      suffix, and the last phase is determined by a flag.  If no
      relevant flag is present, then go all the way through to linking.
      This table summarises:</p><div class="informaltable"><table border="1"><colgroup><col align="left"><col align="left"><col align="left"><col align="left"></colgroup><thead><tr><th align="left">Phase of the compilation system</th><th align="left">Suffix saying &#8220;start here&#8221;</th><th align="left">Flag saying &#8220;stop after&#8221;</th><th align="left">(suffix of) output file</th></tr></thead><tbody><tr><td align="left">literate pre-processor</td><td align="left"><code class="literal">.lhs</code></td><td align="left">-</td><td align="left"><code class="literal">.hs</code></td></tr><tr><td align="left">C pre-processor (opt.) </td><td align="left"><code class="literal">.hs</code> (with
	      <code class="option">-cpp</code>)</td><td align="left"><code class="option">-E</code></td><td align="left"><code class="literal">.hspp</code></td></tr><tr><td align="left">Haskell compiler</td><td align="left"><code class="literal">.hs</code></td><td align="left"><code class="option">-C</code>, <code class="option">-S</code></td><td align="left"><code class="literal">.hc</code>, <code class="literal">.s</code></td></tr><tr><td align="left">C compiler (opt.)</td><td align="left"><code class="literal">.hc</code> or <code class="literal">.c</code></td><td align="left"><code class="option">-S</code></td><td align="left"><code class="literal">.s</code></td></tr><tr><td align="left">assembler</td><td align="left"><code class="literal">.s</code></td><td align="left"><code class="option">-c</code></td><td align="left"><code class="literal">.o</code></td></tr><tr><td align="left">linker</td><td align="left"><em class="replaceable"><code>other</code></em></td><td align="left">-</td><td align="left"><code class="filename">a.out</code></td></tr></tbody></table></div><a class="indexterm" name="idp21703760"></a><a class="indexterm" name="idp21704216"></a><a class="indexterm" name="idp21704672"></a><a class="indexterm" name="idp21705128"></a><p>Thus, a common invocation would be: </p><pre class="screen">
ghc -c Foo.hs</pre><p>to compile the Haskell source file
      <code class="filename">Foo.hs</code> to an object file
      <code class="filename">Foo.o</code>.</p><p>Note: What the Haskell compiler proper produces depends on what
      backend code generator is used. See <a class="xref" href="code-generators.html" title="4.11. GHC Backends">Section 4.11, &#8220;GHC Backends&#8221;</a>
      for more details.</p><p>Note: C pre-processing is optional, the
      <code class="option">-cpp</code><a class="indexterm" name="idp21708200"></a>
      flag turns it on.  See <a class="xref" href="options-phases.html#c-pre-processor" title="4.12.3. Options affecting the C pre-processor">Section 4.12.3, &#8220;Options affecting the C pre-processor&#8221;</a> for more
      details.</p><p>Note: The option <code class="option">-E</code><a class="indexterm" name="idp21709400"></a> runs just the pre-processing passes
      of the compiler, dumping the result in a file.</p><div class="sect3" title="4.5.3.1. Overriding the default behaviour for a file"><div class="titlepage"><div><div><h4 class="title"><a name="overriding-suffixes"></a>4.5.3.1. Overriding the default behaviour for a file</h4></div></div></div><p>As described above, the way in which a file is processed by GHC
	  depends on its suffix.  This behaviour can be overridden using the
	  <code class="option">-x</code> option:</p><div class="variablelist"><dl><dt><span class="term"><code class="option">-x</code> <em class="replaceable"><code>suffix</code></em>
	    	      <a class="indexterm" name="idp21711832"></a></span></dt><dd><p>Causes all files following this option on the command
		  line to be processed as if they had the suffix
		  <em class="replaceable"><code>suffix</code></em>.  For example, to compile a
		  Haskell module in the file <code class="literal">M.my-hs</code>,
		  use <code class="literal">ghc -c -x hs M.my-hs</code>.</p></dd></dl></div></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="file-suffixes.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="using-ghc.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="options-help.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">4.4. Meaningful file suffixes </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 4.6. Help and verbosity options</td></tr></table></div></body></html>
